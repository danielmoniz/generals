<!DOCTYPE html>
<html>
  <head>
    <div id="game"></div>
    <script type="text/javascript" src="lib/perlin.js"></script>
    <script type="text/javascript" src="lib/astar.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <!--
    <script
      src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>

    <script type="text/javascript" src="locations.json"></script>
    <script type="text/javascript" src="factions.json"></script>

    <script type="text/javascript" src="crafty.js"></script>
    <script type="text/javascript" src="game.js"></script>
    <script type="text/javascript" src="src/chat.js"></script>
    <script type="text/javascript" src="src/pathing.js"></script>
    <script type="text/javascript" src="src/build_terrain.js"></script>
    <script type="text/javascript" src="src/map_creator.js"></script>
    <script type="text/javascript" src="src/utility.js"></script>
    <script type="text/javascript" src="src/output.js"></script>
    <script type="text/javascript" src="src/pretty.js"></script>
    <script type="text/javascript" src="src/victory.js"></script>
    <script type="text/javascript" src="src/line_of_sight.js"></script>
    <script type="text/javascript" src="src/scripts.js"></script>
    <script type="text/javascript" src="src/components.js"></script>
    <script type="text/javascript" src="src/components/unit.js"></script>
    <script type="text/javascript" src="src/components/battle.js"></script>
    <script type="text/javascript" src="src/components/terrain.js"></script>
    <script type="text/javascript" src="src/scenes.js"></script>

    <script type="text/javascript">

      var user_num = Math.round(Math.random() * 100000);
      my_username = "User-" + user_num;
      my_messages = {};
      my_current_room = "";

      var socket = io();
      socket.emit("new user", my_username);

      $('form.message').submit(function() {
	var text = $('#m').val();
	if (text) {
	  socket.emit('chat message', text);
	  $('#m').val('');

	}
	$("#m").focus();
	return false;
      });

      $('form.change-name').submit(function() {
	var old_username = my_username;
	var new_username = $('#username').val();
	if (new_username == old_username) {
	  addMessage("Name (" + new_username + ") is the same!");
	  $("input#username").focus();
	  return false;
	}
	socket.emit('change name', old_username, new_username);

	$("#m").focus();
	return false;
      });

      socket.on('name changed', function(new_name) {
	my_username = new_name;
	//$("input#username").val(new_name);
      });

      socket.on('name taken', function(old_name, new_name) {
	var message = "Name '" + new_name + "' already taken.";
	addMessage(message);
	$("input#username").val(old_name);
	$("input#username").focus();
      });

      socket.on('chat message', function(msg) {
	addMessage(msg);
      });

      socket.on('update user list', function(usernames) {
	$("ul#online-users").empty();
	for (var i in usernames) {
	  var new_list_item = makeUsernameListItem(usernames[i]);
	  $('ul#online-users').append(new_list_item);
	}
      });

      socket.on('invite to game', function(invite_id, inviter) {
	var output = inviter + " has invited you to a game.";
	addMessage(output);

	var join = confirm(inviter + " has invited you to a game! Join?");
	if (join) {
	  socket.emit("accept game invite", invite_id);
	  console.log("joining game...");
	} else {
	  var message = "You have declined the game invite from " + inviter +
	    ".";
	  addMessage(message);
	  socket.emit("decline game invite", invite_id);
	}
      });

      socket.on('decline invite', function(username) {
	var output = username + " has declined your game invite.";
	addMessage(output);
	console.log(output);
      });

      socket.on('new game', function(game_name) {
	clearMessages();
	var message = "Joined " + game_name + ".";
	addMessage(message);
	console.log(message);
      });

      socket.on('joined room', function(room_name) {
	my_current_room = room_name;
	clearMessages();
	var message = "You have joined " + room_name + ".";
	addMessage(message);
	console.log(message);
      });
    </script>

    <link rel="stylesheet" type="text/css" href="style.css" />
    <link rel="stylesheet" type="text/css" href="chat.css" />

  </head>
  <body>
    <div id="front-page">
      <h1>Generals</h1>
    </div>
    <div id="game-container">
      <div id="stage">
      </div>

      <div id="tool-bar">
	<input type="button" id="next-turn" value="Start Turn" />
	<div id="message-bar">Ready? Press 'Next Turn' to start!</div>
      </div>

      <div id="info-panel">
      </div>
      <div id="alerts-container">
	Alerts:<br />
	<div id="alerts-panel">
	</div>
      </div>
    </div>

    <div id="input-container">
      <form id="options">
	<h2>Options</h2>
	<input type="checkbox" name="fog_of_war" checked>Fog of war</input>
      </form>
      <input id="menu-toggle-button" class="input-item" type="button"
	value="Menu" />
      <div id="menu">
	<textarea id="load-input" class="input-item"></textarea>
	<input id="save-button" class="input-item" type="button"
	  value="Save game/map" />
	<input id="load-button" class="input-item" type="button"
	  value="Load game" />
	<input id="load-map-button" class="input-item" type="button"
	  value="Load map" />
	<input id="start-email-button" class="input-item start" type="button"
	  game_type="email" value="Start email game" />
	<input id="start-hotseat-button" class="input-item start" type="button"
	  game_type="hotseat" value="Start local hotseat game" />
	<input id="start-online-button" class="input-item start" type="button"
	  game_type="online" value="Start live online game" />
      </div>
    </div>

    <div id="chat">
      <ul id="messages"></ul>
      <ul id="online-users"></ul>
      <form class="message" action="">
	<input id="m" autocomplete="off" />
	<button>Send</button>
      </form>
      <form class="change-name" action="">
	<input id="username" autocomplete="off" value="" />
	<button>Change name</button>
      </form>
    </div>

  </body>
</html>
